<div class="task-container">
  <!-- Add Task Modal -->
  <app-task-form
    *ngIf="showAddModal"
    (taskAdded)="onTaskAdded()"
    (closeModal)="closeAddModal()"
  ></app-task-form>

  <!-- Edit Task Modal -->
  <app-task-edit
    *ngIf="showEditModal && selectedTaskToEdit"
    [task]="selectedTaskToEdit"
    (taskUpdated)="onTaskUpdated()"
    (closeModal)="closeEditModal()"
  ></app-task-edit>

  <!-- Header -->
  <div class="header-section">
    <div class="header-content">
      <h1 class="title">✨ My Tasks</h1>
      <p class="subtitle">Stay organized and productive</p>
    </div>
    <button class="btn-primary btn-lg" (click)="openAddTaskModal()">
      <span class="icon">+</span>
      New Task
    </button>
  </div>

  <!-- Search & Filter Bar -->
  <div class="search-section">
    <div class="search-box">
      <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        type="text"
        placeholder="Search tasks..."
        class="search-input"
      />
    </div>
    <button class="btn-secondary" (click)="loadTasks()" title="Refresh">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0 1 14.85-3.36M20.49 15a9 9 0 0 1-14.85 3.36"></path>
      </svg>
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="tasks.length === 0" class="empty-state">
    <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M9 11l3 3L22 4"></path>
      <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <h2>No tasks yet</h2>
    <p>Create your first task to get started</p>
  </div>

  <!-- Tasks Grid -->
  <div class="tasks-grid">
    <div
      *ngFor="let task of tasks; trackBy: trackByTaskId"
      class="task-card"
      [class.task-completed]="task.status === TaskStatus.DONE"
    >
      <!-- Task Header -->
      <div class="task-header">
        <h3 class="task-title" [class.completed]="task.status === TaskStatus.DONE">
          {{ task.title }}
        </h3>
        <span class="task-badge" [ngClass]="'badge-' + (task.status | lowercase)">
          {{ getStatusLabel(task.status) }}
        </span>
      </div>

      <!-- Task Description -->
      <p *ngIf="task.description" class="task-description">
        {{ task.description }}
      </p>

      <!-- Task Meta -->
      <div class="task-meta">
        <div class="meta-item" *ngIf="task.dueDate">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          {{ task.dueDate | date:'short' }}
        </div>
        <div class="meta-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="1"></circle>
            <path d="M12 1v6m0 6v6"></path>
            <path d="M4.22 4.22l4.24 4.24m2.12 2.12l4.24 4.24"></path>
            <path d="M1 12h6m6 0h6"></path>
            <path d="M4.22 19.78l4.24-4.24m2.12-2.12l4.24-4.24"></path>
            <path d="M12 19v4"></path>
            <path d="M19.78 19.78l-4.24-4.24m-2.12-2.12l-4.24-4.24"></path>
            <path d="M21 12h-6m-6 0H3"></path>
            <path d="M19.78 4.22l-4.24 4.24m-2.12 2.12l-4.24 4.24"></path>
          </svg>
          Created: {{ task.createdAt | date:'short' }}
        </div>
      </div>

      <!-- Task Actions -->
      <div class="task-actions">
        <button
          class="btn-action btn-toggle"
          (click)="toggleStatus(task)"
          [disabled]="task.status === TaskStatus.DONE"
          [title]="
            task.status === TaskStatus.PENDING
              ? 'Marquer en cours'
              : 'Marquer terminé'
          "
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          {{ task.status === TaskStatus.PENDING ? 'Démarrer' : task.status === TaskStatus.IN_PROGRESS ? 'Terminer' : 'Fait' }}
        </button>
        <button
          class="btn-action btn-revert"
          (click)="toggleStatusBackward(task)"
          [disabled]="task.status === TaskStatus.PENDING"
          [title]="
            task.status === TaskStatus.DONE
              ? 'Revenir en cours'
              : 'Revenir à faire'
          "
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M3 7v6h6"></path>
            <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
          </svg>
          {{ task.status === TaskStatus.DONE ? 'Annuler' : 'Retour' }}
        </button>
        <button
          class="btn-action btn-edit"
          (click)="openEditTaskModal(task)"
          title="Modifier la tâche"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Modifier
        </button>
        <button
          class="btn-action btn-delete"
          (click)="deleteTask(task.id!)"
          title="Supprimer la tâche"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          Delete
        </button>
      </div>
    </div>
  </div>
</div>
